#!/usr/bin/bash
set -e

MOUNT="mnt-vault.mount"
SERVICE="tamuvpn.service"
WATCHDOG="tamuvpn-watchdog.service"
SUDO="/usr/bin/sudo"
SYSTEMCTL="/usr/bin/systemctl"
JOURNALCTL="/usr/bin/journalctl"

case "$1" in
  open|start)
    if ! "$SYSTEMCTL" is-active --quiet "$MOUNT"; then
      "$SUDO" "$SYSTEMCTL" start "$MOUNT"
    fi
    "$SUDO" "$SYSTEMCTL" start "$SERVICE"
    ;;

  close|stop)
    "$SUDO" "$SYSTEMCTL" stop "$SERVICE"
    ;;

  r|restart)
    "$SUDO" "$SYSTEMCTL" restart "$SERVICE"
    ;;

  log)
    shift
    "$JOURNALCTL" -eu "$SERVICE" -u "$WATCHDOG" "$@"
    ;;

  status)
    "$SYSTEMCTL" status "$SERVICE" "$WATCHDOG"
    ;;

  *)
    echo "Usage: $0 (start|stop|log|status)" >&2
    exit 1
    ;;
esac
